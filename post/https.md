# HTTPS 相关

HTTPS 建立链接过程：

1. 首先，客户端 A 访问服务器 B ，比如我们用浏览器打开一个网页 www.baidu.com ，这时，浏览器就是客户端 A ，百度的服务器就是服务器 B 了。这时候客户端 A 会生成一个随机数1，把随机数1 、自己支持的 SSL 版本号以及加密算法等这些信息告诉服务器 B 。

2. 服务器 B 知道这些信息后，然后确认一下双方的加密算法，然后服务端也生成一个随机数 B ，并将随机数 B 和 CA 颁发给自己的证书一同返回给客户端 A 。

3. 客户端 A 得到 CA 证书后，会去校验该 CA 证书的有效性，校验方法在上面已经说过了。校验通过后，客户端生成一个随机数3 ，然后用证书中的公钥加密随机数3 并传输给服务端 B 。

4. 服务端 B 得到加密后的随机数3，然后利用私钥进行解密，得到真正的随机数3。

5. 最后，客户端 A 和服务端 B 都有随机数1、随机数2、随机数3，然后双方利用这三个随机数生成一个对话密钥。之后传输内容就是利用对话密钥来进行加解密了。这时就是利用了对称加密，一般用的都是 AES 算法。

6. 客户端 A 通知服务端 B ，指明后面的通讯用对话密钥来完成，同时通知服务器 B 客户端 A 的握手过程结束。

7. 服务端 B 通知客户端 A，指明后面的通讯用对话密钥来完成，同时通知客户端 A 服务器 B 的握手过程结束。

8. SSL 的握手部分结束，SSL 安全通道的数据通讯开始，客户端 A 和服务器 B 开始使用相同的对话密钥进行数据通讯。


![](https://user-gold-cdn.xitu.io/2017/4/29/1b860224a181a59c059e4ead74e24ebe)


CA 证书机构：

1. 作为权威机构，为服务端的公钥合法性做担保。CA 证书机构为服务端颁发证书，证书信息包括：数字签名、服务端公钥等
2. 数字签名保证了证书不被篡改，数字签名是 CA 证书机构将 证书内容的摘要信息用 CA 的私钥进行加密。当客户端接收到服务端发来的证书之后，需要通过 CA 的公钥解密出数字签名的摘要信息，以此来判断证书是否合法有效

HTTPS 的两个加密：

1. 非对称加密：信息加密的密钥是通过非对称加密实现的，客户端将密钥用服务端的公钥加密，服务端用私钥解密出密钥。
2. 对称加密：信息的加密是通过对称加密实现的，客户端和服务端共享相同的一份密钥，即 1 中客户端给服务端密钥。

如果都使用非对称加密的弊端在于，非对称加密的解密过程需要较多的计算资源， 会增加服务器的负担。

HTTPS 中间人攻击：

Charles 采用中间人攻击原理，实现密文的解密

HTTPS性能损耗：

1. 增加延时：完整的握手需要增加 2 次 RTT；利用会话缓存从而复用连接，延时也至少 1* RTT
2. 计算资源：RSA的解密最先成为瓶颈

HTTPS接入优化：

1. CDN接入
2. 会话缓存
3. 硬件加速
4. 远程解密


[HTTP和HTTPS详解](https://juejin.im/post/5af557a3f265da0b9265a498)

[深入解析 HTTPS](https://juejin.im/entry/5904345ab123db3ee4755ebb)

[腾讯 HTTPS 性能优化实践](https://juejin.im/entry/58abe9bd1b69e6006c1279ac)
